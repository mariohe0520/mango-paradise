/* ═══════════════════════════════════════════════════════════════════
   芒果庄园 — 3D Effects & Premium Visual Upgrade
   Perspective board, particle explosions, screen shake, depth
   ═══════════════════════════════════════════════════════════════════ */

/* ── 3D Board Perspective ── */
.game-board-container {
  perspective: 800px !important;
  perspective-origin: 50% 40% !important;
}

#game-board {
  transform-style: preserve-3d !important;
  transform: rotateX(2deg) !important;
  transition: transform 0.3s cubic-bezier(.25,.46,.45,.94) !important;
}

/* Subtle board tilt on interaction */
#game-board.tilt-left  { transform: rotateX(2deg) rotateY(-1.5deg) !important; }
#game-board.tilt-right { transform: rotateX(2deg) rotateY(1.5deg) !important; }
#game-board.tilt-up    { transform: rotateX(4deg) !important; }
#game-board.tilt-down  { transform: rotateX(0deg) !important; }

/* Board depth shadow */
#game-board::after {
  content: '';
  position: absolute;
  bottom: -8px; left: 5%; right: 5%;
  height: 16px;
  background: radial-gradient(ellipse, rgba(0,0,0,0.3) 0%, transparent 70%);
  filter: blur(6px);
  z-index: -1;
  pointer-events: none;
}

/* ── 3D Gem Depth ── */
.gem {
  transform-style: preserve-3d !important;
  backface-visibility: hidden !important;
}

/* Gem hover lift */
.gem:active {
  transform: scale(1.1) translateZ(8px) !important;
  filter: drop-shadow(0 6px 12px rgba(0,0,0,0.5)) brightness(1.15) !important;
}

/* ── Match Explosion Particles ── */
@keyframes matchExplode {
  0% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.8); opacity: 0.6; }
  100% { transform: scale(2.5); opacity: 0; }
}

@keyframes matchRing {
  0% { transform: scale(0.5); opacity: 0.8; border-width: 3px; }
  100% { transform: scale(2.5); opacity: 0; border-width: 0.5px; }
}

.gem.matching {
  animation: matchFlash 0.4s ease-out !important;
  z-index: 10 !important;
}

@keyframes matchFlash {
  0% { transform: scale(1); filter: brightness(1); }
  30% { transform: scale(1.3); filter: brightness(2) drop-shadow(0 0 15px currentColor); }
  60% { transform: scale(0.8); filter: brightness(1.5); }
  100% { transform: scale(0) rotate(180deg); filter: brightness(3); opacity: 0; }
}

/* Gem fall-in bounce */
.gem.dropping {
  animation: gemDrop 0.35s cubic-bezier(.34,1.56,.64,1) !important;
}

@keyframes gemDrop {
  0% { transform: translateY(-60px) scale(0.6); opacity: 0; }
  60% { transform: translateY(4px) scale(1.05); opacity: 1; }
  80% { transform: translateY(-2px) scale(0.98); }
  100% { transform: translateY(0) scale(1); }
}

/* ── Screen Shake ── */
@keyframes boardShake {
  0%, 100% { transform: rotateX(2deg) translate(0,0); }
  10% { transform: rotateX(2deg) translate(-3px, 2px); }
  20% { transform: rotateX(2deg) translate(3px, -2px); }
  30% { transform: rotateX(2deg) translate(-2px, 1px); }
  40% { transform: rotateX(2deg) translate(2px, -1px); }
  50% { transform: rotateX(2deg) translate(-1px, 1px); }
}

@keyframes boardShakeHeavy {
  0%, 100% { transform: rotateX(2deg) translate(0,0); }
  10% { transform: rotateX(3deg) translate(-6px, 4px) rotate(-0.5deg); }
  20% { transform: rotateX(1deg) translate(6px, -4px) rotate(0.5deg); }
  30% { transform: rotateX(3deg) translate(-4px, 2px) rotate(-0.3deg); }
  40% { transform: rotateX(1deg) translate(4px, -2px) rotate(0.3deg); }
  50% { transform: rotateX(2deg) translate(-2px, 1px); }
}

#game-board.shake {
  animation: boardShake 0.3s ease-out !important;
}

#game-board.shake-heavy {
  animation: boardShakeHeavy 0.5s ease-out !important;
}

/* ── Combo Counter 3D ── */
.combo-display {
  transform-style: preserve-3d;
  animation: comboPopIn 0.4s cubic-bezier(.34,1.56,.64,1);
  text-shadow: 
    0 2px 4px rgba(0,0,0,0.5),
    0 0 20px currentColor;
}

@keyframes comboPopIn {
  0% { transform: scale(0) rotateY(-90deg); opacity: 0; }
  60% { transform: scale(1.2) rotateY(10deg); opacity: 1; }
  100% { transform: scale(1) rotateY(0); }
}

/* ── Score Popup 3D ── */
.score-popup {
  animation: scoreFloat 1s ease-out forwards !important;
  font-weight: 800 !important;
  text-shadow: 0 2px 8px rgba(0,0,0,0.5), 0 0 20px currentColor !important;
  pointer-events: none !important;
}

@keyframes scoreFloat {
  0% { transform: translateY(0) scale(0.5) rotateX(30deg); opacity: 0; }
  20% { transform: translateY(-10px) scale(1.2) rotateX(0); opacity: 1; }
  100% { transform: translateY(-50px) scale(0.8); opacity: 0; }
}

/* ── Special Gem 3D Glow ── */
.gem.special.row-blast,
.gem.special.col-blast {
  animation: specialPulse 1.5s ease-in-out infinite !important;
}

@keyframes specialPulse {
  0%, 100% { 
    filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5)) drop-shadow(0 0 8px rgba(255,215,0,0.3)) !important; 
  }
  50% { 
    filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5)) drop-shadow(0 0 20px rgba(255,215,0,0.6)) !important; 
  }
}

.gem.special.bomb {
  animation: bombPulse 1s ease-in-out infinite !important;
}

@keyframes bombPulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.08) rotate(3deg); }
}

.gem.special.rainbow {
  animation: rainbowShimmer 2s linear infinite !important;
}

@keyframes rainbowShimmer {
  0% { filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5)) hue-rotate(0deg) brightness(1.1); }
  50% { filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5)) hue-rotate(180deg) brightness(1.3); }
  100% { filter: drop-shadow(0 3px 5px rgba(0,0,0,0.5)) hue-rotate(360deg) brightness(1.1); }
}

/* ── Level Complete Celebration ── */
@keyframes victoryBurst {
  0% { transform: scale(0) rotate(-180deg); opacity: 0; }
  50% { transform: scale(1.3) rotate(10deg); opacity: 1; }
  70% { transform: scale(0.95) rotate(-3deg); }
  100% { transform: scale(1) rotate(0); }
}

.level-complete-overlay {
  animation: victoryBurst 0.6s cubic-bezier(.34,1.56,.64,1) !important;
}

/* ── Ambient Background Particles ── */
.game-screen::before {
  content: '';
  position: fixed;
  top: 0; left: 0; right: 0; bottom: 0;
  background: 
    radial-gradient(2px 2px at 20% 30%, rgba(168,85,247,0.15) 0%, transparent 100%),
    radial-gradient(2px 2px at 80% 70%, rgba(249,115,22,0.12) 0%, transparent 100%),
    radial-gradient(2px 2px at 50% 50%, rgba(34,197,94,0.1) 0%, transparent 100%);
  animation: ambientDrift 15s ease-in-out infinite;
  pointer-events: none;
  z-index: 0;
}

@keyframes ambientDrift {
  0%, 100% { opacity: 0.5; transform: translateY(0); }
  50% { opacity: 0.8; transform: translateY(-10px); }
}

/* ── Board Glow Border ── */
#game-board {
  box-shadow: 
    0 0 20px rgba(168,85,247,0.1),
    0 0 40px rgba(168,85,247,0.05),
    inset 0 0 30px rgba(0,0,0,0.2) !important;
  border: 1px solid rgba(168,85,247,0.15) !important;
}

/* ── Cell Hover 3D ── */
.grid-cell {
  transition: transform 0.1s ease, box-shadow 0.1s ease !important;
  transform-style: preserve-3d !important;
}

.grid-cell:active {
  transform: translateZ(-2px) scale(0.95) !important;
  box-shadow: inset 0 2px 8px rgba(0,0,0,0.3) !important;
}

/* ── Gem Selected Ring ── */
.grid-cell.selected .gem {
  animation: selectedBounce 0.8s ease-in-out infinite !important;
  filter: drop-shadow(0 0 12px rgba(255,255,255,0.6)) brightness(1.2) !important;
}

@keyframes selectedBounce {
  0%, 100% { transform: scale(1) translateZ(4px); }
  50% { transform: scale(1.1) translateZ(8px); }
}

/* ── Boss Fight Overlay ── */
.boss-fight-active #game-board {
  border-color: rgba(239,68,68,0.3) !important;
  box-shadow: 
    0 0 30px rgba(239,68,68,0.15),
    0 0 60px rgba(239,68,68,0.05),
    inset 0 0 30px rgba(239,68,68,0.05) !important;
}

/* ── Power-up Activation Flash ── */
@keyframes powerFlash {
  0% { background: rgba(255,255,255,0); }
  20% { background: rgba(255,255,255,0.15); }
  100% { background: rgba(255,255,255,0); }
}

.power-flash {
  animation: powerFlash 0.4s ease-out !important;
}

/* ── Loading Screen 3D ── */
#loading-screen .game-logo {
  transform-style: preserve-3d;
  animation: logoFloat 3s ease-in-out infinite;
}

@keyframes logoFloat {
  0%, 100% { transform: translateY(0) rotateX(0); }
  25% { transform: translateY(-8px) rotateX(2deg); }
  75% { transform: translateY(4px) rotateX(-1deg); }
}

/* ── Menu Card Hover 3D ── */
.menu-btn, .mode-card {
  transform-style: preserve-3d !important;
  transition: transform 0.2s ease, box-shadow 0.2s ease !important;
}

.menu-btn:active, .mode-card:active {
  transform: scale(0.96) translateZ(-4px) !important;
}
