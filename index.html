<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a0a2e">
    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-title" content="芒果庄园">
    <title>芒果庄园 - Mango Paradise</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='mg' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%23fef3c7'/><stop offset='50%' stop-color='%23f59e0b'/><stop offset='100%' stop-color='%23d97706'/></linearGradient></defs><ellipse cx='50' cy='52' rx='38' ry='42' fill='url(%23mg)' stroke='%23b45309' stroke-width='2'/><path d='M50 10 Q55 0 60 5 Q58 12 50 10Z' fill='%2322c55e'/></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700;900&family=Noto+Sans+SC:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/premium.css">
    <link rel="stylesheet" href="css/polish.css">
    <link rel="stylesheet" href="css/gems.css">
</head>
<body>
    <!-- 加载画面 -->
    <div id="loading-screen" class="screen active">
        <div class="loading-content">
            <div class="game-logo">
                <span class="logo-icon"><svg viewBox="0 0 40 40" width="40" height="40"><defs><linearGradient id="mango-g" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fef3c7"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient></defs><ellipse cx="20" cy="22" rx="15" ry="17" fill="url(#mango-g)" stroke="#b45309" stroke-width="1.5"/><path d="M20 5Q23 0 26 3Q24 8 20 5Z" fill="#22c55e"/></svg></span>
                <h1 class="logo-text">芒果庄园</h1>
                <p class="logo-subtitle">MANGO PARADISE</p>
            </div>
            <div class="loading-bar-container">
                <div class="loading-bar">
                    <div class="loading-progress"></div>
                </div>
                <p class="loading-text">正在召唤艾泽拉斯的力量...</p>
            </div>
            <div class="loading-tips">
                <p id="loading-tip"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M9 18h6M10 22h4M12 2a7 7 0 0 1 4 12.9V17H8v-2.1A7 7 0 0 1 12 2z" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> 提示：连接4个以上可以产生特殊宝石！</p>
            </div>
        </div>
        <div class="particles" id="loading-particles"></div>
    </div>

    <!-- 主菜单 -->
    <div id="main-menu" class="screen">
        <div class="menu-background">
            <div class="floating-elements"></div>
        </div>
        <div class="menu-content">
            <div class="menu-header">
                <div class="player-info">
                    <div class="player-avatar" id="menu-avatar"><svg viewBox="0 0 24 24" width="28" height="28"><circle cx="12" cy="8" r="5" fill="none" stroke="#a78bfa" stroke-width="1.5"/><path d="M5 20c0-3.87 3.13-7 7-7s7 3.13 7 7" fill="none" stroke="#a78bfa" stroke-width="1.5"/><path d="M7 3l5-1 5 1-2 4H9z" fill="#7c3aed" opacity="0.3"/></svg></div>
                    <div class="player-details">
                        <span class="player-name" id="menu-player-name">冒险者</span>
                        <span class="player-level">Lv.<span id="menu-player-level">1</span></span>
                    </div>
                </div>
                <div class="currency-display">
                    <div class="currency gold">
                        <span class="currency-icon"><svg class="inline-icon" viewBox="0 0 24 24" width="18" height="18"><circle cx="12" cy="12" r="10" fill="#f59e0b" stroke="#b45309" stroke-width="1.5"/><circle cx="12" cy="12" r="6" fill="none" stroke="#fef3c7" stroke-width="1.5"/><text x="12" y="16" text-anchor="middle" font-size="10" font-weight="bold" fill="#78350f">G</text></svg></span>
                        <span class="currency-amount" id="menu-gold">0</span>
                    </div>
                    <div class="currency gems">
                        <span class="currency-icon"><svg class="inline-icon" viewBox="0 0 24 24" width="18" height="18"><path d="M12 2L4 10l8 12 8-12z" fill="#60a5fa" stroke="#1d4ed8" stroke-width="1.5" stroke-linejoin="round"/><path d="M4 10h16M12 2l-4 8m4-8l4 8" fill="none" stroke="#93c5fd" stroke-width="1" opacity="0.6"/></svg></span>
                        <span class="currency-amount" id="menu-gems">0</span>
                    </div>
                </div>
            </div>
            
            <div class="power-stats" id="power-stats"></div>

            <div class="menu-logo">
                <div class="logo-glow"></div>
                <span class="menu-logo-icon"><svg viewBox="0 0 48 48" width="48" height="48"><defs><linearGradient id="mango-g2" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fef3c7"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient></defs><ellipse cx="24" cy="26" rx="18" ry="20" fill="url(#mango-g2)" stroke="#b45309" stroke-width="1.5"/><path d="M24 6Q28 0 32 4Q29 10 24 6Z" fill="#22c55e"/><ellipse cx="18" cy="20" rx="6" ry="4" fill="rgba(255,255,255,0.25)" transform="rotate(-20 18 20)"/></svg></span>
                <h1>芒果庄园</h1>
            </div>

            <div class="menu-buttons">
                <button class="menu-btn primary" id="btn-adventure" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M14.5 3L12 7l-2.5-4L7 6l-3-1 1.5 5L3 14l4 1 2 6h6l2-6 4-1-2.5-4L20 5l-3 1-2.5-3z" fill="none" stroke="currentColor" stroke-width="1.8"/><line x1="12" y1="7" x2="12" y2="15" stroke="currentColor" stroke-width="1.5"/></svg></span>
                    <span class="btn-text">开始冒险</span>
                    <span class="btn-subtitle">第 <span id="current-level-display">1</span> 关</span>
                </button>
                <button class="menu-btn" id="btn-collection" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg></span>
                    <span class="btn-text">图鉴收集</span>
                </button>
                <button class="menu-btn" id="btn-achievements" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg></span>
                    <span class="btn-text">成就殿堂</span>
                </button>
                <button class="menu-btn" id="btn-daily" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M20 12v10H4V12"/><path d="M2 7h20v5H2z"/><path d="M12 22V7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg></span>
                    <span class="btn-text">每日签到</span>
                    <span class="btn-badge" id="daily-badge" style="display:none">!</span>
                </button>
                <button class="menu-btn" id="btn-estate" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M3 21h18"/><path d="M5 21V7l7-4 7 4v14"/><path d="M9 21v-6h6v6"/><path d="M10 9h4"/><path d="M10 13h4"/></svg></span>
                    <span class="btn-text">芒果庄园</span>
                    <span class="btn-subtitle">种树 · 精灵 · Buff</span>
                </button>
                <button class="menu-btn highlight" id="btn-daily-challenge" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M14.5 3L12 7l-2.5-4L7 6l-3-1 1.5 5L3 14l4 1 2 6h6l2-6 4-1-2.5-4L20 5l-3 1-2.5-3z" fill="none" stroke="currentColor" stroke-width="1.8"/><circle cx="12" cy="12" r="2" fill="currentColor" stroke="none"/></svg></span>
                    <span class="btn-text">每日挑战</span>
                    <span class="btn-subtitle">每天不同 · 限时 · 特殊规则</span>
                </button>
                <button class="menu-btn" id="btn-endless" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M18.178 8c5.096 0 5.096 8 0 8-5.095 0-7.133-8-12.739-8-4.585 0-4.585 8 0 8 5.606 0 7.644-8 12.74-8z"/></svg></span>
                    <span class="btn-text">无尽模式</span>
                    <span class="btn-subtitle">经典 · 限时 · 生存</span>
                </button>
                <button class="menu-btn highlight" id="btn-tower" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M7 22V2h10v20"/><path d="M4 22h16"/><path d="M7 10h10"/><path d="M7 6h10"/><path d="M7 14h10"/><path d="M7 18h10"/><path d="M10 2V0"/><path d="M14 2V0"/><rect x="10" y="18" width="4" height="4" rx="0.5"/></svg></span>
                    <span class="btn-text">挑战塔</span>
                    <span class="btn-subtitle">50层 · 特殊规则 · 终极Boss</span>
                </button>
                <button class="menu-btn" id="btn-stats" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M18 20V10"/><path d="M12 20V4"/><path d="M6 20v-6"/></svg></span>
                    <span class="btn-text">统计数据</span>
                    <span class="btn-subtitle">成就 · 数据 · 趋势</span>
                </button>
                <button class="menu-btn highlight" id="btn-seasonal" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
                    <span class="btn-text">季节活动</span>
                    <span class="btn-subtitle" id="seasonal-subtitle">当月活动</span>
                </button>
                <button class="menu-btn highlight" id="btn-weekly" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg></span>
                    <span class="btn-text">周赛</span>
                    <span class="btn-subtitle">每周主题 · 排行榜 · 奖励</span>
                </button>
                <button class="menu-btn" id="btn-revenge" data-sound="click" style="display:none;">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2z"/><path d="M8 9l1.5 1.5L8 12"/><path d="M16 9l-1.5 1.5L16 12"/><path d="M8 16s1.5 2 4 2 4-2 4-2"/></svg></span>
                    <span class="btn-text">Boss复仇</span>
                    <span class="btn-subtitle">被击败的Boss回来了！</span>
                </button>
                <button class="menu-btn highlight" id="btn-season" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89L17 22l-5-3-5 3 1.523-9.11"/></svg></span>
                    <span class="btn-text">赛季</span>
                    <span class="btn-subtitle" id="season-subtitle">本月赛季</span>
                </button>
                <button class="menu-btn" id="btn-leaderboard" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><path d="M12 2L15 8.5 22 9.27 17 14 18.18 21 12 17.77 5.82 21 7 14 2 9.27 9 8.5z"/></svg></span>
                    <span class="btn-text">排行榜</span>
                </button>
                <button class="menu-btn" id="btn-settings" data-sound="click">
                    <span class="btn-icon"><svg class="btn-svg-icon" viewBox="0 0 24 24"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></span>
                    <span class="btn-text">设置</span>
                </button>
            </div>

            <div class="offline-reward" id="offline-reward" style="display:none">
                <div class="reward-content">
                    <h3><svg class="inline-icon" viewBox="0 0 24 24" width="18" height="18"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" fill="none" stroke="#fbbf24" stroke-width="2"/></svg> 离线收益</h3>
                    <p>你离开了 <span id="offline-time">0</span></p>
                    <div class="reward-items">
                        <div class="reward-item"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="10" fill="#f59e0b" stroke="#b45309" stroke-width="1.5"/><text x="12" y="16" text-anchor="middle" font-size="10" font-weight="bold" fill="#78350f">G</text></svg> +<span id="offline-gold">0</span></div>
                    </div>
                    <button class="btn-claim" id="btn-claim-offline">领取奖励</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 关卡选择 -->
    <div id="level-select" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-levels">
                <span>←</span>
            </button>
            <h2>选择关卡</h2>
            <div class="header-currency">
                <span class="currency gold"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="10" fill="#f59e0b" stroke="#b45309" stroke-width="1.5"/><text x="12" y="16" text-anchor="middle" font-size="10" font-weight="bold" fill="#78350f">G</text></svg> <span id="levels-gold">0</span></span>
                <span class="currency gems"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M12 2L4 10l8 12 8-12z" fill="#60a5fa" stroke="#1d4ed8" stroke-width="1.5" stroke-linejoin="round"/></svg> <span id="levels-gems">0</span></span>
            </div>
        </div>
        <div class="chapter-tabs" id="chapter-tabs">
            <!-- 章节标签将由JS生成 -->
        </div>
        <div class="levels-grid" id="levels-grid">
            <!-- 关卡按钮将由JS生成 -->
        </div>
        <div class="chapter-info" id="chapter-info">
            <h3 id="chapter-name">第一章：艾尔文森林</h3>
            <p id="chapter-desc">芒果树林中潜伏着神秘的力量...</p>
        </div>
    </div>

    <!-- 游戏主界面 -->
    <div id="game-screen" class="screen">
        <div class="game-header">
            <button class="btn-pause" id="btn-pause"><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><rect x="6" y="4" width="4" height="16" rx="1" fill="currentColor"/><rect x="14" y="4" width="4" height="16" rx="1" fill="currentColor"/></svg></button>
            <div class="level-info">
                <span class="level-chapter" id="game-chapter">第一章</span>
                <span class="level-number">关卡 <span id="game-level">1</span></span>
            </div>
            <div class="game-stats">
                <div class="stat moves">
                    <span class="stat-icon"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M18 11V6a2 2 0 0 0-4 0M14 11V4a2 2 0 0 0-4 0M10 11V6a2 2 0 0 0-4 0v5M6 11a4 4 0 0 0-2 3.5V18a6 6 0 0 0 6 6h4a6 6 0 0 0 6-6v-3.5a4 4 0 0 0-2-3.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/><path d="M18 11V9a2 2 0 0 1 4 0v4.5a9 9 0 0 1-9 9.5" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/></svg></span>
                    <span class="stat-value" id="moves-left">30</span>
                </div>
                <div class="stat score">
                    <span class="stat-icon"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01z" fill="#fbbf24" stroke="#d97706" stroke-width="1"/></svg></span>
                    <span class="stat-value" id="current-score">0</span>
                </div>
            </div>
        </div>

        <!-- Boss HP Bar -->
        <div class="boss-bar" id="boss-bar" style="display:none">
            <div class="boss-info">
                <span class="boss-icon" id="boss-icon"><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><circle cx="12" cy="12" r="10" fill="#7f1d1d" stroke="#ef4444" stroke-width="1.5"/><path d="M8 9l2 2M16 9l-2 2M8 16c2 2 6 2 8 0" fill="none" stroke="#fca5a5" stroke-width="1.5" stroke-linecap="round"/><path d="M6 4l3 3M18 4l-3 3" fill="none" stroke="#ef4444" stroke-width="2" stroke-linecap="round"/></svg></span>
                <span class="boss-name" id="boss-name">Boss</span>
            </div>
            <div class="boss-hp-bar">
                <div class="boss-hp-fill" id="boss-hp-fill"></div>
            </div>
            <span class="boss-hp-text" id="boss-hp-text">0/0</span>
            <!-- Boss Rage Meter -->
            <div class="boss-rage-meter">
                <span class="rage-label"><svg class="inline-icon" viewBox="0 0 24 24" width="14" height="14"><path d="M4 4l4 4M20 4l-4 4M4 20l4-4M20 20l-4-4" fill="none" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"/></svg></span>
                <div class="rage-bar">
                    <div class="rage-fill" id="boss-rage-fill"></div>
                </div>
                <span class="rage-text" id="boss-rage-text">0%</span>
            </div>
        </div>

        <!-- Active Buffs -->
        <div class="active-buffs" id="active-buffs" style="display:none"></div>

        <!-- Timer for timed levels -->
        <div class="stat timer-stat" id="timer-wrap" style="display:none">
            <span class="stat-icon"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="13" r="8" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 9v4l3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M10 2h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg></span>
            <span class="stat-value" id="timer-display">0</span>
        </div>

        <div class="game-objectives" id="game-objectives">
            <!-- 目标将由JS生成 -->
        </div>

        <div class="game-board-container">
            <div class="board-frame">
                <div class="board-corner tl"></div>
                <div class="board-corner tr"></div>
                <div class="board-corner bl"></div>
                <div class="board-corner br"></div>
                <div id="game-board" class="game-board">
                    <!-- 游戏棋盘将由JS生成 -->
                </div>
            </div>
        </div>

        <!-- Combined powerups + skill bar (single row) -->
        <div class="game-bottom-bar">
            <div class="game-powerups">
                <button class="powerup-btn" id="powerup-hammer" data-powerup="hammer">
                    <span class="powerup-icon"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M6 12L10 3h4l4 9" fill="#94a3b8" stroke="#475569" stroke-width="1.5" stroke-linejoin="round"/><rect x="11" y="12" width="2" height="10" rx="1" fill="#92400e" stroke="#78350f" stroke-width="1"/></svg></span>
                    <span class="powerup-count" id="hammer-count">3</span>
                </button>
                <button class="powerup-btn" id="powerup-shuffle" data-powerup="shuffle">
                    <span class="powerup-icon"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M16 3h5v5M4 20L21 3M21 16v5h-5M15 15l6 6M4 4l5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    <span class="powerup-count" id="shuffle-count">3</span>
                </button>
                <button class="powerup-btn" id="powerup-hint" data-powerup="hint">
                    <span class="powerup-icon"><svg viewBox="0 0 24 24" width="22" height="22"><path d="M9 18h6M10 22h4M12 2a7 7 0 0 1 4 12.9V17H8v-2.1A7 7 0 0 1 12 2z" fill="none" stroke="#fbbf24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                    <span class="powerup-count" id="hint-count">5</span>
                </button>
            </div>
            <div class="skill-bar-compact" id="skill-bar-container">
                <div class="skill-bar-track">
                    <div class="skill-bar-fill" id="skill-bar-fill"></div>
                </div>
                <button class="skill-activate-btn" id="skill-activate-btn" disabled>
                    <span class="skill-spirit-icon" id="skill-spirit-icon"><svg viewBox="0 0 24 24" width="20" height="20"><circle cx="12" cy="7" r="3" fill="none" stroke="#c084fc" stroke-width="1.5"/><path d="M8 20c0-2.2 1.8-4 4-4s4 1.8 4 4" fill="none" stroke="#c084fc" stroke-width="1.5"/><path d="M6 10l-3 4M18 10l3 4M9 5l-2-3M15 5l2-3" fill="none" stroke="#e9d5ff" stroke-width="1" stroke-linecap="round" opacity="0.7"/></svg></span>
                </button>
            </div>
        </div>

        <div class="combo-display" id="combo-display" style="display:none">
            <span class="combo-text">COMBO</span>
            <span class="combo-count" id="combo-count">x2</span>
        </div>

        <div class="game-particles" id="game-particles"></div>
    </div>

    <!-- 暂停菜单 -->
    <div id="pause-menu" class="modal">
        <div class="modal-content pause-content">
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><rect x="6" y="4" width="4" height="16" rx="1" fill="currentColor"/><rect x="14" y="4" width="4" height="16" rx="1" fill="currentColor"/></svg> 游戏暂停</h2>
            <div class="pause-stats">
                <p>当前分数: <span id="pause-score">0</span></p>
                <p>剩余步数: <span id="pause-moves">0</span></p>
            </div>
            <div class="pause-buttons">
                <button class="modal-btn primary" id="btn-resume">继续游戏</button>
                <button class="modal-btn" id="btn-restart">重新开始</button>
                <button class="modal-btn danger" id="btn-quit">退出关卡</button>
            </div>
        </div>
    </div>

    <!-- 胜利界面 -->
    <div id="victory-screen" class="modal">
        <div class="modal-content victory-content">
            <div class="victory-stars" id="victory-stars">
                <span class="star" data-star="1"><svg viewBox="0 0 24 24" width="32" height="32"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01z" fill="#fbbf24" stroke="#d97706" stroke-width="1"/></svg></span>
                <span class="star" data-star="2"><svg viewBox="0 0 24 24" width="32" height="32"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01z" fill="#fbbf24" stroke="#d97706" stroke-width="1"/></svg></span>
                <span class="star" data-star="3"><svg viewBox="0 0 24 24" width="32" height="32"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87L18.18 21 12 17.77 5.82 21 7 14.14 2 9.27l6.91-1.01z" fill="#fbbf24" stroke="#d97706" stroke-width="1"/></svg></span>
            </div>
            <h2 class="victory-title"><svg class="inline-icon" viewBox="0 0 24 24" width="24" height="24"><path d="M12 2l2 4 4.5.65-3.25 3.17.77 4.47L12 12.17 7.98 14.3l.77-4.47L5.5 6.65 10 6z" fill="#fbbf24" stroke="none"/><circle cx="5" cy="18" r="1.5" fill="#ef4444"/><circle cx="19" cy="18" r="1.5" fill="#3b82f6"/><circle cx="12" cy="20" r="1.5" fill="#22c55e"/><path d="M3 3l3 5M21 3l-3 5" fill="none" stroke="#fbbf24" stroke-width="1.5" stroke-linecap="round"/></svg> 胜利！</h2>
            <div class="victory-stats">
                <div class="stat-row">
                    <span>得分</span>
                    <span id="victory-score">0</span>
                </div>
                <div class="stat-row">
                    <span>最高连击</span>
                    <span id="victory-combo">0</span>
                </div>
                <div class="stat-row highlight">
                    <span>获得金币</span>
                    <span><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="10" fill="#f59e0b" stroke="#b45309" stroke-width="1.5"/><text x="12" y="16" text-anchor="middle" font-size="10" font-weight="bold" fill="#78350f">G</text></svg> +<span id="victory-gold">0</span></span>
                </div>
            </div>
            <p class="victory-next-star" id="victory-next-star"></p>
            <div class="victory-buff-summary" id="victory-buff-summary"></div>
            <div class="victory-buttons">
                <button class="modal-btn" id="btn-victory-menu">返回菜单</button>
                <button class="modal-btn primary" id="btn-next-level">下一关 <svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M5 12h14M13 5l7 7-7 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </div>
        </div>
        <div class="confetti" id="confetti"></div>
    </div>

    <!-- 失败界面 -->
    <div id="defeat-screen" class="modal">
        <div class="modal-content defeat-content">
            <div class="defeat-icon"><svg viewBox="0 0 48 48" width="48" height="48"><circle cx="24" cy="24" r="20" fill="#4b5563" stroke="#6b7280" stroke-width="2"/><circle cx="16" cy="18" r="2" fill="#9ca3af"/><circle cx="32" cy="18" r="2" fill="#9ca3af"/><path d="M16 34c4-3 8-3 16 0" fill="none" stroke="#9ca3af" stroke-width="2" stroke-linecap="round"/><path d="M14 16l4 1M30 17l4-1" fill="none" stroke="#9ca3af" stroke-width="1.5" stroke-linecap="round"/></svg></div>
            <h2>挑战失败</h2>
            <p class="defeat-message" id="defeat-message">别灰心，再试一次！</p>
            <div class="defeat-stats">
                <p>得分: <span id="defeat-score">0</span></p>
                <p>目标完成: <span id="defeat-progress">0%</span></p>
            </div>
            <div class="defeat-buttons">
                <button class="modal-btn gold" id="btn-continue-moves">
                    <span><svg class="inline-icon" viewBox="0 0 24 24" width="14" height="14"><path d="M12 2L4 10l8 12 8-12z" fill="#60a5fa" stroke="#1d4ed8" stroke-width="1.5" stroke-linejoin="round"/></svg> +5步继续 (50<svg class="inline-icon" viewBox="0 0 24 24" width="12" height="12"><path d="M12 2L4 10l8 12 8-12z" fill="#60a5fa" stroke="#1d4ed8" stroke-width="1.5" stroke-linejoin="round"/></svg>)</span>
                </button>
                <button class="modal-btn primary" id="btn-retry">
                    <span><svg class="inline-icon" viewBox="0 0 24 24" width="14" height="14"><path d="M1 4v6h6M23 20v-6h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> 重新挑战</span>
                </button>
                <button class="modal-btn" id="btn-defeat-menu">返回菜单</button>
            </div>
        </div>
    </div>

    <!-- 每日签到 -->
    <div id="daily-checkin" class="modal">
        <div class="modal-content checkin-content">
            <button class="modal-close" id="close-daily">×</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><rect x="3" y="4" width="18" height="18" rx="2" fill="none" stroke="currentColor" stroke-width="2"/><path d="M16 2v4M8 2v4M3 10h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> 每日签到</h2>
            <p class="checkin-streak">连续签到: <span id="checkin-streak">0</span> 天</p>
            <div class="checkin-calendar" id="checkin-calendar">
                <!-- 签到日历将由JS生成 -->
            </div>
            <button class="modal-btn primary" id="btn-checkin" disabled>今日已签到</button>
        </div>
    </div>

    <!-- 成就界面 -->
    <div id="achievements-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-achievements">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z" fill="none" stroke="#fbbf24" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg> 成就殿堂</h2>
            <div class="achievement-progress">
                <span id="achievements-unlocked">0</span>/<span id="achievements-total">0</span>
            </div>
        </div>
        <div class="achievements-list" id="achievements-list">
            <!-- 成就列表将由JS生成 -->
        </div>
    </div>

    <!-- 图鉴界面 -->
    <div id="collection-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-collection">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z" fill="none" stroke="currentColor" stroke-width="2"/></svg> 芒果图鉴</h2>
            <div class="collection-progress">
                <span id="collection-unlocked">0</span>/<span id="collection-total">0</span>
            </div>
        </div>
        <div class="collection-tabs">
            <button class="tab-btn active" data-tab="creatures">种族</button>
            <button class="tab-btn" data-tab="items">道具</button>
            <button class="tab-btn" data-tab="specials">特殊</button>
        </div>
        <div class="collection-grid" id="collection-grid">
            <!-- 图鉴内容将由JS生成 -->
        </div>
        <div class="collection-detail" id="collection-detail" style="display:none">
            <!-- 图鉴详情将由JS生成 -->
        </div>
    </div>

    <!-- 排行榜 -->
    <div id="leaderboard-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-leaderboard">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><path d="M12 2L15 8.5 22 9.27 17 14 18.18 21 12 17.77 5.82 21 7 14 2 9.27 9 8.5z" fill="none" stroke="#fbbf24" stroke-width="1.8"/></svg> 排行榜</h2>
        </div>
        <div class="leaderboard-tabs">
            <button class="tab-btn active" data-tab="score">总分榜</button>
            <button class="tab-btn" data-tab="level">关卡榜</button>
            <button class="tab-btn" data-tab="streak">连胜榜</button>
        </div>
        <div class="leaderboard-list" id="leaderboard-list">
            <!-- 排行榜将由JS生成 -->
        </div>
        <div class="my-rank" id="my-rank">
            <!-- 我的排名 -->
        </div>
    </div>

    <!-- 统计界面 -->
    <div id="stats-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-stats">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><path d="M18 20V10M12 20V4M6 20v-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> 统计数据</h2>
        </div>
        <div class="stats-content" id="stats-content" style="padding:12px;overflow-y:auto;max-height:calc(100vh - 60px);">
            <!-- Stats will be rendered by JS -->
        </div>
    </div>

    <!-- 季节活动界面 -->
    <div id="seasonal-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-seasonal">←</button>
            <h2 id="seasonal-title"><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><circle cx="12" cy="12" r="5" fill="none" stroke="#fbbf24" stroke-width="2"/><line x1="12" y1="1" x2="12" y2="3" stroke="#fbbf24" stroke-width="2"/><line x1="12" y1="21" x2="12" y2="23" stroke="#fbbf24" stroke-width="2"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64" stroke="#fbbf24" stroke-width="2"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78" stroke="#fbbf24" stroke-width="2"/><line x1="1" y1="12" x2="3" y2="12" stroke="#fbbf24" stroke-width="2"/><line x1="21" y1="12" x2="23" y2="12" stroke="#fbbf24" stroke-width="2"/></svg> 季节活动</h2>
        </div>
        <div class="seasonal-content" id="seasonal-content" style="padding:12px;overflow-y:auto;max-height:calc(100vh - 60px);">
            <!-- Seasonal content will be rendered by JS -->
        </div>
    </div>

    <!-- 挑战塔界面 -->
    <div id="tower-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-tower">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><path d="M7 22V2h10v20M4 22h16M7 10h10M7 6h10M7 14h10M7 18h10" fill="none" stroke="currentColor" stroke-width="1.8"/><rect x="10" y="18" width="4" height="4" rx="0.5" fill="none" stroke="currentColor" stroke-width="1.5"/></svg> 挑战塔</h2>
            <div class="tower-progress-header">
                <span id="tower-floor-display">第1层</span>
            </div>
        </div>
        <div class="tower-content" id="tower-content" style="padding:12px;overflow-y:auto;max-height:calc(100vh - 60px);">
            <!-- Tower floors will be rendered by JS -->
        </div>
    </div>

    <!-- 设置界面 -->
    <div id="settings-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-settings">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c.26.604.852.997 1.51 1H21a2 2 0 0 1 0 4h-.09c-.66 0-1.25.39-1.51 1z" fill="none" stroke="currentColor" stroke-width="2"/></svg> 设置</h2>
        </div>
        <div class="settings-content">
            <div class="setting-group">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M9 18V5l12-2v13" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="6" cy="18" r="3" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="18" cy="16" r="3" fill="none" stroke="currentColor" stroke-width="2"/></svg> 音效</h3>
                <div class="setting-item">
                    <span>音效</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-sfx" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>背景音乐</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-music" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>音量</span>
                    <input type="range" id="setting-volume" min="0" max="100" value="80">
                </div>
            </div>
            <div class="setting-group">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><rect x="2" y="6" width="20" height="12" rx="3" fill="none" stroke="currentColor" stroke-width="2"/><line x1="6" y1="12" x2="10" y2="12" stroke="currentColor" stroke-width="2"/><line x1="8" y1="10" x2="8" y2="14" stroke="currentColor" stroke-width="2"/><circle cx="15" cy="10" r="1" fill="currentColor"/><circle cx="18" cy="12" r="1" fill="currentColor"/></svg> 游戏</h3>
                <div class="setting-item">
                    <span>震动反馈</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-vibration" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
                <div class="setting-item">
                    <span>粒子效果</span>
                    <label class="toggle">
                        <input type="checkbox" id="setting-particles" checked>
                        <span class="toggle-slider"></span>
                    </label>
                </div>
            </div>
            <div class="setting-group">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="12" cy="7" r="4" fill="none" stroke="currentColor" stroke-width="2"/></svg> 玩家</h3>
                <div class="setting-item">
                    <span>昵称</span>
                    <input type="text" id="setting-name" placeholder="输入昵称" maxlength="12">
                </div>
                <div class="setting-item">
                    <span>头像</span>
                    <div class="avatar-selector" id="avatar-selector">
                        <span class="avatar-option selected" data-avatar="mage"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-mage)"/><defs><radialGradient id="av-mage"><stop offset="0%" stop-color="#93c5fd"/><stop offset="100%" stop-color="#1d4ed8"/></radialGradient></defs><path d="M10 12h12l-6-8z" fill="#7c3aed" opacity="0.6"/><circle cx="12" cy="16" r="1.5" fill="#fff"/><circle cx="20" cy="16" r="1.5" fill="#fff"/></svg></span>
                        <span class="avatar-option" data-avatar="elf"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-elf)"/><defs><radialGradient id="av-elf"><stop offset="0%" stop-color="#d8b4fe"/><stop offset="100%" stop-color="#7c3aed"/></radialGradient></defs><circle cx="12" cy="15" r="1.5" fill="#fff"/><circle cx="20" cy="15" r="1.5" fill="#fff"/><path d="M4 12l5 4M28 12l-5 4" fill="none" stroke="#e9d5ff" stroke-width="2" stroke-linecap="round"/></svg></span>
                        <span class="avatar-option" data-avatar="undead"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-undead)"/><defs><radialGradient id="av-undead"><stop offset="0%" stop-color="#99f6e4"/><stop offset="100%" stop-color="#0d9488"/></radialGradient></defs><circle cx="12" cy="14" r="2" fill="#134e4a"/><circle cx="20" cy="14" r="2" fill="#134e4a"/><path d="M10 20h12" stroke="#134e4a" stroke-width="2"/></svg></span>
                        <span class="avatar-option" data-avatar="knight"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-knight)"/><defs><radialGradient id="av-knight"><stop offset="0%" stop-color="#e2e8f0"/><stop offset="100%" stop-color="#64748b"/></radialGradient></defs><rect x="8" y="8" width="16" height="10" rx="3" fill="#94a3b8" opacity="0.5"/><rect x="10" y="18" width="12" height="3" rx="1" fill="#475569" opacity="0.5"/><circle cx="12" cy="14" r="1.5" fill="#1e293b"/><circle cx="20" cy="14" r="1.5" fill="#1e293b"/></svg></span>
                        <span class="avatar-option" data-avatar="dragon"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-dragon)"/><defs><radialGradient id="av-dragon"><stop offset="0%" stop-color="#fca5a5"/><stop offset="100%" stop-color="#b91c1c"/></radialGradient></defs><circle cx="11" cy="13" r="2" fill="#fef3c7"/><circle cx="21" cy="13" r="2" fill="#fef3c7"/><path d="M12 20c4 3 8 0 8 0" fill="none" stroke="#7f1d1d" stroke-width="2"/><path d="M6 6l4 5M26 6l-4 5" fill="none" stroke="#ef4444" stroke-width="2.5" stroke-linecap="round"/></svg></span>
                        <span class="avatar-option" data-avatar="orc"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-orc)"/><defs><radialGradient id="av-orc"><stop offset="0%" stop-color="#86efac"/><stop offset="100%" stop-color="#16a34a"/></radialGradient></defs><circle cx="12" cy="14" r="2" fill="#14532d"/><circle cx="20" cy="14" r="2" fill="#14532d"/><path d="M10 20l2-2 2 2 2-2 2 2 2-2" fill="none" stroke="#14532d" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></span>
                        <span class="avatar-option" data-avatar="phoenix"><svg viewBox="0 0 32 32" width="32" height="32"><circle cx="16" cy="16" r="14" fill="url(#av-phoenix)"/><defs><radialGradient id="av-phoenix"><stop offset="0%" stop-color="#fff7ed"/><stop offset="50%" stop-color="#fb923c"/><stop offset="100%" stop-color="#ea580c"/></radialGradient></defs><circle cx="12" cy="14" r="1.5" fill="#7c2d12"/><circle cx="20" cy="14" r="1.5" fill="#7c2d12"/><path d="M8 6c2 3 4 2 4 2M24 6c-2 3-4 2-4 2" fill="none" stroke="#f97316" stroke-width="2" stroke-linecap="round"/></svg></span>
                        <span class="avatar-option" data-avatar="mango"><svg viewBox="0 0 32 32" width="32" height="32"><defs><radialGradient id="av-mango"><stop offset="0%" stop-color="#fef3c7"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></radialGradient></defs><ellipse cx="16" cy="18" rx="12" ry="13" fill="url(#av-mango)" stroke="#b45309" stroke-width="1"/><path d="M16 5Q18 1 21 3Q19 7 16 5Z" fill="#22c55e"/></svg></span>
                    </div>
                </div>
            </div>
            <div class="setting-group danger-zone">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" fill="none" stroke="#f59e0b" stroke-width="2"/><line x1="12" y1="9" x2="12" y2="13" stroke="#f59e0b" stroke-width="2"/><circle cx="12" cy="17" r="1" fill="#f59e0b"/></svg> 数据</h3>
                <button class="btn-danger" id="btn-reset-progress">重置游戏进度</button>
                <button class="btn-export" id="btn-export-save">导出存档</button>
                <button class="btn-import" id="btn-import-save">导入存档</button>
                <input type="file" id="import-file" accept=".json" style="display:none">
            </div>
        </div>
    </div>

    <!-- 庄园界面 -->
    <div id="estate-screen" class="screen">
        <div class="screen-header">
            <button class="btn-back" id="btn-back-estate">←</button>
            <h2><svg class="inline-icon" viewBox="0 0 24 24" width="20" height="20"><path d="M3 21h18M5 21V7l7-4 7 4v14M9 21v-6h6v6M10 9h4M10 13h4" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg> 芒果庄园</h2>
            <div class="header-currency">
                <span class="currency gold"><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><circle cx="12" cy="12" r="10" fill="#f59e0b" stroke="#b45309" stroke-width="1.5"/><text x="12" y="16" text-anchor="middle" font-size="10" font-weight="bold" fill="#78350f">G</text></svg> <span id="estate-gold">0</span></span>
            </div>
        </div>
        <div class="estate-content">
            <!-- Happiness -->
            <div class="estate-section happiness-section">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78L12 21.23l8.84-8.84a5.5 5.5 0 0 0 0-7.78z" fill="#f472b6" stroke="#ec4899" stroke-width="1"/></svg> 庄园幸福度: <span id="estate-happiness">0</span></h3>
                <div class="happiness-bar"><div class="happiness-fill" id="happiness-fill"></div></div>
                <p class="happiness-hint" id="happiness-hint">幸福度超过200后，消消乐分数永久1.2倍！</p>
            </div>
            <!-- Trees -->
            <div class="estate-section">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M12 22V8" fill="none" stroke="#92400e" stroke-width="2"/><path d="M5 12c0-4 3-7 7-7s7 3 7 7" fill="#22c55e" stroke="#16a34a" stroke-width="1.5"/><path d="M8 8c0-3 2-5 4-5s4 2 4 5" fill="#4ade80" stroke="#22c55e" stroke-width="1"/></svg> 种植芒果树 → 永久Buff</h3>
                <div class="tree-grid" id="tree-grid"></div>
            </div>
            <!-- Spirits -->
            <div class="estate-section">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M12 2l1.5 4.5L18 8l-4.5 1.5L12 14l-1.5-4.5L6 8l4.5-1.5z" fill="#fbbf24" stroke="#d97706" stroke-width="1"/><path d="M5 16l1 2.5L3 20l2.5-1L5 16z" fill="#fbbf24" opacity="0.6"/><path d="M19 16l1 2.5-3 1.5 2.5-1L19 16z" fill="#fbbf24" opacity="0.6"/></svg> 派遣精灵 → 觉醒大招</h3>
                <div class="spirit-grid" id="spirit-grid"></div>
            </div>
            <!-- Decorations -->
            <div class="estate-section">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z" fill="none" stroke="currentColor" stroke-width="2"/><circle cx="8" cy="10" r="1.5" fill="#ef4444"/><circle cx="12" cy="7" r="1.5" fill="#fbbf24"/><circle cx="16" cy="10" r="1.5" fill="#22c55e"/></svg> 庄园装饰</h3>
                <div class="deco-grid" id="deco-grid"></div>
            </div>
            <!-- Active Buffs Summary -->
            <div class="estate-section">
                <h3><svg class="inline-icon" viewBox="0 0 24 24" width="16" height="16"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" fill="none" stroke="#fbbf24" stroke-width="2"/></svg> 当前生效Buff</h3>
                <div class="buff-summary" id="buff-summary"></div>
            </div>
        </div>
    </div>

    <!-- 关卡故事对话框 -->
    <div id="story-dialog" class="modal">
        <div class="modal-content story-dialog-content">
            <div class="story-character" id="story-character"><svg viewBox="0 0 40 40" width="40" height="40"><defs><linearGradient id="story-mg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fef3c7"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient></defs><ellipse cx="20" cy="22" rx="15" ry="17" fill="url(#story-mg)" stroke="#b45309" stroke-width="1.5"/><path d="M20 5Q23 0 26 3Q24 8 20 5Z" fill="#22c55e"/></svg></div>
            <div class="story-text-container">
                <p class="story-text" id="story-text"></p>
            </div>
            <button class="modal-btn primary" id="story-continue-btn">继续 ▶</button>
        </div>
    </div>

    <!-- 新手教程 -->
    <div id="tutorial-overlay" class="tutorial-overlay" style="display:none">
        <div class="tutorial-spotlight" id="tutorial-spotlight"></div>
        <div class="tutorial-dialog" id="tutorial-dialog">
            <div class="tutorial-character"><svg viewBox="0 0 40 40" width="40" height="40"><defs><linearGradient id="tut-mg" x1="0" y1="0" x2="1" y2="1"><stop offset="0%" stop-color="#fef3c7"/><stop offset="50%" stop-color="#f59e0b"/><stop offset="100%" stop-color="#d97706"/></linearGradient></defs><ellipse cx="20" cy="22" rx="15" ry="17" fill="url(#tut-mg)" stroke="#b45309" stroke-width="1.5"/><path d="M20 5Q23 0 26 3Q24 8 20 5Z" fill="#22c55e"/></svg></div>
            <div class="tutorial-text" id="tutorial-text"></div>
            <div class="tutorial-buttons">
                <button class="tutorial-btn" id="tutorial-skip">跳过教程</button>
                <button class="tutorial-btn primary" id="tutorial-next">下一步</button>
            </div>
            <div class="tutorial-progress" id="tutorial-progress"></div>
        </div>
    </div>

    <!-- 成就解锁提示 -->
    <div id="achievement-popup" class="achievement-popup">
        <div class="achievement-content">
            <span class="achievement-icon" id="popup-achievement-icon"><svg viewBox="0 0 24 24" width="24" height="24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z" fill="none" stroke="#fbbf24" stroke-width="1.8"/></svg></span>
            <div class="achievement-info">
                <span class="achievement-label">成就解锁！</span>
                <span class="achievement-name" id="popup-achievement-name"></span>
            </div>
        </div>
    </div>

    <!-- 通用提示 -->
    <div id="toast" class="toast"></div>

    <!-- 脚本 -->
    <script src="js/utils.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/levelgen.js"></script>
    <script src="js/levels.js"></script>
    <script src="js/achievements.js"></script>
    <script src="js/collection.js"></script>
    <script src="js/estate.js"></script>
    <script src="js/boss.js"></script>
    <script src="js/story.js"></script>
    <script src="js/daily.js"></script>
    <script src="js/seasons.js"></script>
    <script src="js/stats.js"></script>
    <script src="js/hardcore.js"></script>
    <script src="js/game.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/tutorial.js"></script>
    <script src="js/main.js"></script>
</body>
</html>
